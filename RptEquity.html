<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>R Wadiwala</title>
    <link rel="stylesheet" href="style/jquery.mobile-1.0.1.min.css" />
    <link rel="stylesheet" href="style/main.css" />
    <link rel="Stylesheet" href="style/MyRedTheme.css" />

    <script src="scripts/jquery-1.6.4.js" type="text/javascript"></script>
    <script src="scripts/jquery.mobile-1.0.1.min.js" type="text/javascript"></script>
    <script src="scripts/Utility.js" type="text/javascript"></script>

    <script src="scripts/jquery.jqplot.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="style/jquery.jqplot.min.css" />
    <script src="scripts/jqplot.pieRenderer.min.js" type="text/javascript"></script>
    
    <script language="javascript" type="text/javascript">
        var blnResponse = false;
        var Response;
        sessionStorage.R_Mobileapp_LastPageBrowsed = "RptEquity.html";

        $(document).ready(function () {
            $("#dvProcessing").show();
            $("#lblClientInfo").text(localStorage.R_Mobileapp_GraphClientName);
            $("#lblSchemeInfo").text(localStorage.R_Mobileapp_SchemeNameName);

            var surl = "http://123.201.85.74:5088/newdynamicboaddins_new/RwMobile/ReceiveLogin.aspx?callback=?&action=GetSeondGraph&Username=" + localStorage.R_Mobileapp_UserName + "&ClientCode=" + localStorage.R_Mobileapp_GraphClient + "&SchemeCode=" + localStorage.R_Mobileapp_GraphScheme+ "&Prevparam=" + sessionStorage.getItem("GraphSelection");
           
            $.getJSON(surl, function (rtndata) {
                Response = rtndata;
                blnResponse = true;
                PopulateReport();
            });

            //  var t1 = setTimeout(function () { PopulateReport(); }, 2000);




            $('#container').bind('jqplotDataClick',
                    function (ev, seriesIndex, pointIndex, data) {
                        var strName;
                        var strValue;

                        strName = data.toString().substring(0, data.toString().lastIndexOf(','));
                        strValue = data.toString().substring(data.toString().lastIndexOf(',') + 1);

                        //var strTemp = data.toString().split(',');

                        strName = strName.replace(/&/, '--');
                        sessionStorage.setItem("GridSelection", strName);

                        //Submit to equity report
                        document.forms[0].action = "RptAssetDetails.html";
                        document.forms[0].submit();


                        //alert("ev = " + ev + " seriesIndex = " + seriesIndex + "pointIndex = " + pointIndex + "data = " + data);
                    });
        });

            function PopulateReport() {                
                var data = [];
                $.each(Response, function (key, val) {
                    cnt = 0;
                    $.each(val.SecondGraphReport, function () {
                        $.each(this, function (key, val) {
                            data[cnt] = [key, parseFloat(val)];
                            cnt = cnt + 1;
                        });
                    });
                });

                //Adjust height of plotting
                if (cnt > 5) 
                {
                    var height = 250 + ((cnt - 1) * 30);
                    $("#container").height(height);   
                         
                }
                
                var plot1 = jQuery.jqplot('container', [data],
                {
                    seriesDefaults: {
                        // Make this a pie chart.
                        renderer: jQuery.jqplot.PieRenderer,
                        rendererOptions: {
                            // Put data labels on the pie slices.
                            // By default, labels show the percentage of the slice.
                            showDataLabels: true
                        }
                    },
                    legend: { show: true, showSwatch: true, location: 's', rendererOptions: { numberColumns: 1} },
                    grid: { background: '#E5E5E5', borderColor: '#E5E5E5' }
                }
                );
                $("#dvProcessing").hide();
             
        }
            
    </script>
    <style type="text/css">
        .ui-page
        {
            background: transparent url(style/images/bg_hor.png);
        }
    </style>
    
</head>
<body>
    <div class="modal" id="dvProcessing"></div>
    <div data-role="page" data-theme="b">
        <form id="frmAssetAllocation" method="post">
        <div data-theme="a" data-role="header" data-position="fixed">
            <table width="100%" cellpadding="0" cellspacing="0" border="0">
                <tr>
                    <td style="width: 10%;text-align:left;padding-left:10px">
                        <a href="#" onclick="Home();">
                            <img src="style/images/house.png" height="20px" width="20px" alt="Home" />
                        </a>
                    </td>
                    <td style="height: 42px; text-align: center; width: 80%">
                        R. Wadiwala PMS
                    </td>
                    <td style="width: 10%; text-align: right;padding-right:10px">
                        <a href="#" onclick="Logout();">
                            <img src="style/images/logout.jpg" height="20px" width="20px" alt="Logout" />
                        </a>
                    </td>
                    <td>&nbsp;</td>
                </tr>
            </table>
        </div>
        <div  data-role="header" data-theme="b" data-position="fixed" style="background-color:Maroon">
             <table style="padding-left:2px;padding-right:2px;padding-top:2px;vertical-align:middle; font-weight:normal" width="100%" height="20px" cellpadding="0" cellspacing="0" border="0" >
            <tr>
                <td style="text-align:center" >
                    <label id="lblClientInfo"></label>  
                </td>
            </tr>
            <tr>
                <td style="text-align:center" >
                    <label id="lblSchemeInfo" style="font-size:14px;"></label>  
                </td>
            </tr>
        </table>
        </div>
        <form id="Form1">
        <table width="100%" cellpadding="5" cellspacing="0" border="0">
            <tr>
                <td colspan="4" style="height:10px"></td>
            </tr>
            <tr>
                <td colspan="4">
                    <center>
                        <div style="margin: 0 1em; width: auto;">
                            <div id="container" style="width: 250px; height: 300px; margin: 0 auto; ">
                            </div>
                        </div>
                    </center>
                </td>
            </tr>
        </table>
        <input type="hidden" name="hdEquity" id="hdEquity" value="80" />
        </form>
        <!--<div data-theme="a" id="footerwrapper" data-role="footer" data-position="fixed" style="height: 35px;text-align:center"  >
            <div style="height:10px"></div>
            <div>
                <span class="spn" onclick="ChangeClient();">Change Client</span>
            </div>
        </div>-->
    </div>
</body>
</html>

